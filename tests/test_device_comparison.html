<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Device Comparison Test</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      font-family: Arial, sans-serif;
    }
    
    .comparison-container {
      padding: 15px;
      max-width: 900px;
      margin: 0 auto;
    }
    
    .header {
      text-align: center;
      margin-bottom: 20px;
    }
    
    .device-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .device-card {
      background: rgba(0,0,0,0.7);
      border-radius: 12px;
      padding: 15px;
      border: 2px solid rgba(255,255,255,0.1);
      transition: transform 0.2s ease;
    }
    
    .device-card:hover {
      transform: translateY(-2px);
      border-color: rgba(255,255,255,0.3);
    }
    
    .device-name {
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 10px;
      color: #4CAF50;
    }
    
    .device-specs {
      font-size: 12px;
      opacity: 0.8;
      margin-bottom: 15px;
    }
    
    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
    }
    
    .metric-item {
      background: rgba(255,255,255,0.1);
      padding: 8px;
      border-radius: 4px;
      text-align: center;
      font-size: 11px;
    }
    
    .metric-value {
      font-size: 14px;
      font-weight: bold;
      margin-bottom: 2px;
    }
    
    .metric-label {
      opacity: 0.7;
    }
    
    .score-good { color: #4CAF50; }
    .score-ok { color: #FFA726; }
    .score-poor { color: #FF6B6B; }
    
    .current-device {
      border: 2px solid #4CAF50;
      box-shadow: 0 0 10px rgba(76, 175, 80, 0.3);
    }
    
    .controls {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .control-button {
      background: rgba(76, 175, 80, 0.9);
      color: white;
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      font-size: 12px;
      cursor: pointer;
      flex: 1;
      min-width: 120px;
    }
    
    .control-button:hover {
      background: rgba(76, 175, 80, 1);
    }
    
    .recommendations {
      background: rgba(0,0,0,0.8);
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
    }
    
    .recommendation-item {
      padding: 8px 0;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .recommendation-item:last-child {
      border-bottom: none;
    }
    
    .back-button {
      position: fixed;
      bottom: 10px;
      right: 10px;
      background: rgba(76, 175, 80, 0.9);
      color: white;
      padding: 8px 16px;
      border: none;
      border-radius: 20px;
      font-size: 12px;
      cursor: pointer;
      z-index: 1001;
    }
  </style>
</head>
<body>
  <div class="comparison-container">
    <div class="header">
      <h1>üì± Device Comparison & Optimization</h1>
      <p>Compare XmasMM performance across different devices</p>
    </div>
    
    <div class="controls">
      <button class="control-button" onclick="refreshMetrics()">üîÑ Refresh All</button>
      <button class="control-button" onclick="runComparisonTest()">‚ö° Run Test</button>
      <button class="control-button" onclick="exportReport()">üìä Export Report</button>
    </div>
    
    <div class="device-grid" id="device-grid">
      <!-- Device cards will be populated by JavaScript -->
    </div>
    
    <div class="recommendations" id="recommendations">
      <h3>üí° Optimization Recommendations</h3>
      <div id="recommendation-list">
        <!-- Recommendations will be populated by JavaScript -->
      </div>
    </div>
  </div>
  
  <button class="back-button" onclick="window.location.href='index.html'">‚Üê Back to Tests</button>
  
  <script>
    const deviceProfiles = [
      {
        name: "iPhone SE (2020)",
        screen: { width: 375, height: 667 },
        specs: "A13 Bionic ‚Ä¢ 3GB RAM ‚Ä¢ 326 PPI",
        category: "budget",
        performance: 0.8
      },
      {
        name: "iPhone 15",
        screen: { width: 390, height: 844 },
        specs: "A16 Bionic ‚Ä¢ 6GB RAM ‚Ä¢ 460 PPI",
        category: "flagship",
        performance: 1.0
      },
      {
        name: "iPhone 15 Pro Max",
        screen: { width: 428, height: 926 },
        specs: "A17 Pro ‚Ä¢ 8GB RAM ‚Ä¢ 460 PPI",
        category: "premium",
        performance: 1.2
      },
      {
        name: "Samsung Galaxy S24",
        screen: { width: 384, height: 854 },
        specs: "Snapdragon 8 Gen 3 ‚Ä¢ 8GB RAM ‚Ä¢ 416 PPI",
        category: "flagship",
        performance: 1.1
      },
      {
        name: "Google Pixel 8",
        screen: { width: 412, height: 915 },
        specs: "Tensor G3 ‚Ä¢ 8GB RAM ‚Ä¢ 428 PPI",
        category: "flagship",
        performance: 0.95
      },
      {
        name: "iPad (10th gen)",
        screen: { width: 768, height: 1024 },
        specs: "A14 Bionic ‚Ä¢ 4GB RAM ‚Ä¢ 264 PPI",
        category: "tablet",
        performance: 1.3
      }
    ];
    
    function calculateDeviceMetrics(device) {
      const { width, height } = device.screen;
      const isSmallScreen = width < 500;
      
      // Canvas calculation (matching main.js logic)
      const baseHeaderHeight = isSmallScreen ? 140 : 120;
      const headerSpace = Math.max(baseHeaderHeight, height * 0.22);
      const bottomMargin = isSmallScreen ? 60 : 80;
      const gameAreaHeight = height - headerSpace - bottomMargin;
      
      // Responsive calculations
      const aspectRatio = width / height;
      const screenUtilization = (gameAreaHeight * width) / (width * height);
      const gameSpacePercentage = (gameAreaHeight / height) * 100;
      
      // Performance scoring
      let optimizationScore = 100;
      if (gameSpacePercentage < 60) optimizationScore -= 30;
      if (screenUtilization < 0.6) optimizationScore -= 20;
      if (headerSpace > height * 0.3) optimizationScore -= 25;
      
      optimizationScore *= device.performance;
      
      return {
        screenUtilization: Math.round(screenUtilization * 100),
        gameSpacePercentage: Math.round(gameSpacePercentage),
        headerSpacePixels: Math.round(headerSpace),
        gameAreaPixels: Math.round(gameAreaHeight),
        optimizationScore: Math.round(optimizationScore),
        aspectRatio: aspectRatio.toFixed(2)
      };
    }
    
    function getScoreClass(score) {
      if (score >= 80) return 'score-good';
      if (score >= 60) return 'score-ok';
      return 'score-poor';
    }
    
    function createDeviceCard(device, metrics, isCurrent = false) {
      const card = document.createElement('div');
      card.className = `device-card ${isCurrent ? 'current-device' : ''}`;
      
      card.innerHTML = `
        <div class="device-name">${device.name} ${isCurrent ? '(Current)' : ''}</div>
        <div class="device-specs">${device.specs}</div>
        <div class="metrics-grid">
          <div class="metric-item">
            <div class="metric-value ${getScoreClass(metrics.optimizationScore)}">${metrics.optimizationScore}%</div>
            <div class="metric-label">Optimization</div>
          </div>
          <div class="metric-item">
            <div class="metric-value ${getScoreClass(metrics.screenUtilization)}">${metrics.screenUtilization}%</div>
            <div class="metric-label">Screen Use</div>
          </div>
          <div class="metric-item">
            <div class="metric-value">${metrics.gameSpacePercentage}%</div>
            <div class="metric-label">Game Area</div>
          </div>
          <div class="metric-item">
            <div class="metric-value">${metrics.aspectRatio}</div>
            <div class="metric-label">Aspect Ratio</div>
          </div>
        </div>
      `;
      
      return card;
    }
    
    function getCurrentDevice() {
      const { width, height } = { width: window.innerWidth, height: window.innerHeight };
      
      // Find closest matching device
      let closestDevice = deviceProfiles[0];
      let closestDistance = Math.abs(width - closestDevice.screen.width) + Math.abs(height - closestDevice.screen.height);
      
      deviceProfiles.forEach(device => {
        const distance = Math.abs(width - device.screen.width) + Math.abs(height - device.screen.height);
        if (distance < closestDistance) {
          closestDistance = distance;
          closestDevice = device;
        }
      });
      
      return {
        ...closestDevice,
        name: `${closestDevice.name} (Detected)`,
        screen: { width, height }
      };
    }
    
    function refreshMetrics() {
      const deviceGrid = document.getElementById('device-grid');
      deviceGrid.innerHTML = '';
      
      const currentDevice = getCurrentDevice();
      const currentMetrics = calculateDeviceMetrics(currentDevice);
      
      // Add current device first
      deviceGrid.appendChild(createDeviceCard(currentDevice, currentMetrics, true));
      
      // Add other devices
      deviceProfiles.forEach(device => {
        const metrics = calculateDeviceMetrics(device);
        deviceGrid.appendChild(createDeviceCard(device, metrics));
      });
      
      generateRecommendations(currentDevice, currentMetrics);
    }
    
    function generateRecommendations(currentDevice, currentMetrics) {
      const recommendations = [];
      
      if (currentMetrics.screenUtilization < 70) {
        recommendations.push("üéØ Consider reducing header space to improve screen utilization");
      }
      
      if (currentMetrics.gameSpacePercentage < 60) {
        recommendations.push("üìè Game area is too small - optimize layout for better mobile experience");
      }
      
      if (currentDevice.screen.width < 400) {
        recommendations.push("üì± Small screen detected - ensure touch targets are at least 44px");
      }
      
      if (currentMetrics.optimizationScore < 70) {
        recommendations.push("‚ö° Overall optimization needs improvement - review responsive design");
      }
      
      if (currentDevice.category === 'budget') {
        recommendations.push("üíæ Consider performance optimizations for budget devices");
      }
      
      if (recommendations.length === 0) {
        recommendations.push("‚úÖ Device is well optimized for XmasMM!");
      }
      
      const recommendationList = document.getElementById('recommendation-list');
      recommendationList.innerHTML = recommendations.map(rec => 
        `<div class="recommendation-item">${rec}</div>`
      ).join('');
    }
    
    function runComparisonTest() {
      // Simulate a quick performance test
      const startTime = performance.now();
      
      // Test canvas creation speed
      for (let i = 0; i < 10; i++) {
        const canvas = document.createElement('canvas');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        const ctx = canvas.getContext('2d');
        ctx.fillRect(0, 0, 100, 100);
      }
      
      const endTime = performance.now();
      const testDuration = endTime - startTime;
      
      alert(`Performance Test Complete!
      
Canvas Creation: ${testDuration.toFixed(2)}ms
Rating: ${testDuration < 10 ? 'Excellent' : testDuration < 50 ? 'Good' : 'Needs Optimization'}

Current Viewport: ${window.innerWidth}√ó${window.innerHeight}
Optimization Score: ${calculateDeviceMetrics(getCurrentDevice()).optimizationScore}%`);
    }
    
    function exportReport() {
      const currentDevice = getCurrentDevice();
      const currentMetrics = calculateDeviceMetrics(currentDevice);
      
      const report = `XmasMM Device Optimization Report
Generated: ${new Date().toLocaleDateString()}

Current Device: ${currentDevice.name}
Screen Resolution: ${currentDevice.screen.width}√ó${currentDevice.screen.height}
Screen Utilization: ${currentMetrics.screenUtilization}%
Game Area: ${currentMetrics.gameSpacePercentage}%
Optimization Score: ${currentMetrics.optimizationScore}%

Comparison with other devices:
${deviceProfiles.map(device => {
  const metrics = calculateDeviceMetrics(device);
  return `${device.name}: ${metrics.optimizationScore}% optimization`;
}).join('\n')}`;
      
      // Create and download report
      const blob = new Blob([report], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'xmasmm-optimization-report.txt';
      a.click();
      URL.revokeObjectURL(url);
    }
    
    // Initialize on load
    document.addEventListener('DOMContentLoaded', refreshMetrics);
    window.addEventListener('resize', refreshMetrics);
  </script>
</body>
</html>
